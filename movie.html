<html>
  <head>
    
<script src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>

    <script>

var name = '';
var visitorLocation = '';
var triedCountry = false;

var notificationHandler = function(data) {
    // Do something with the notifications
};

var notifyWhenDone = function(err) {
    if (err) {
        // Do something with the error
    }
    // called when the bind is completed successfully,
    // or when the action terminated with an error.
};


var updateCallback = function(data) {
    // Do something with the returning data
    var path = data.key;
    var value = data.newValue;
    // called each time the value is updated.
    // If there's an existing value when bind is called - this callback
    // will be called with the existing value
    if (path === 'visitorInfo.visitorName') {
        lpTag.agentSDK.command(lpTag.agentSDK.cmdNames.write,
            {text: 'Hello ' + value + '!'}, notifyWhenDone);
        if (visitorLocation) {
            lpTag.agentSDK.command(lpTag.agentSDK.cmdNames.write,
                {text: 'I see you are from ' + visitorLocation.visitorLocation}, notifyWhenDone);
        }
    }
};


var onSuccess = function(data) {
    // Do something with the returning data
    visitorLocation = data;
    lpTag.agentSDK.bind('visitorInfo.visitorName', updateCallback, notifyWhenDone);
};

var onError = function(err) {
    // Do something with the error
    if (err) {
        if (!triedCountry) {
            triedCountry = true;
            lpTag.agentSDK.get('country', onSuccess, onError);
        } else {
            lpTag.agentSDK.bind('visitorInfo.visitorName', updateCallback, notifyWhenDone);
        }
    }

  };

//lpTag.agentSDK.init({notificationCallback: notificationHandler});
//lpTag.agentSDK.get('city', onSuccess, onError);
      
        async function search() {
          var query = document.getElementById("search-input").value;
          // Perform search logic here and retrieve the results
          var api_url = "https://www.omdbapi.com/?t="+query+"&apikey=cf60bf6d";
          const response = await fetch(api_url);
          var results = await response.json();

          //alert("Key: " + results.key + " Value: " + results.value);

          var resultsBody = document.getElementById("results-body");
          resultsBody.innerHTML = "";
    
          Object.keys(results).forEach(function(key) {
                var value = results[key];
                var row = resultsBody.insertRow();
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                cell1.innerHTML = key;
                cell2.innerHTML = value;

                console.log('Key: ' + key + ', Value: ' + value);
            });
        }
    </script>

    <style>
    /* CSS styles for the search box and table */
    #search-box {
        margin-bottom: 10px;
    }
    #results-table {
        border-collapse: collapse;
        width: 100%;
    }
    #results-table td, #results-table th {
        border: 1px solid black;
        padding: 8px;
    }
    #results-table th {
        background-color: #f2f2f2;
    }
    </style>
    
  </head>
<body>
    <div id="search-box">
        <input type="text" id="search-input" placeholder="Enter movie name here">
        <button onclick="search()">Search</button>
      </div>
      <table id="results-table">
        <thead>
          <tr>
            <th>Parameter</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody id="results-body">
        </tbody>
      </table>
    
</body>
  
</html>
